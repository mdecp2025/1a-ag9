<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ†¤æ€’é³¥éŠæˆ² - ä¸‰è±¬åˆ†æ•£ç‰ˆ</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.10.7/brython.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.10.7/brython_stdlib.js"></script>
    
    <style>
        body { 
            text-align: center; 
            font-family: "Microsoft JhengHei", Arial, sans-serif; 
            background-color: #2c3e50; 
            color: white;
            margin: 0;
            padding: 20px;
        }
        canvas { 
            background: linear-gradient(to bottom, #87CEEB 0%, #E0F6FF 100%); 
            border: 5px solid #34495e; 
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: block; 
            margin: 20px auto; 
            touch-action: none; /* é˜²æ­¢æ‰‹æ©Ÿç€è¦½å™¨é è¨­ç¸®æ”¾ */
        }
        .scoreboard {
            font-size: 24px;
            background: #34495e;
            display: inline-block;
            padding: 10px 30px;
            border-radius: 50px;
            margin-bottom: 10px;
        }
        .highlight { color: #f1c40f; }
    </style>
</head>
<body onload="brython()">

    <h1>æ†¤æ€’é³¥éŠæˆ² <span class="highlight">Angry Pigs</span></h1>
    
    <div class="scoreboard">
        å¾—åˆ†: <span id="score_display" class="highlight">0</span> | 
        å‰©é¤˜å°é³¥: <span id="shots_remaining" class="highlight">10</span>
    </div>

    <canvas id="gameCanvas" width="800" height="400"></canvas>

    <p>ğŸ’¡ æç¤ºï¼šä½¿ç”¨æ»‘é¼ æŒ‰ä½å°é³¥å‘å¾Œæ‹‰ï¼Œèª¿æ•´è§’åº¦èˆ‡åŠ›é“å¾Œæ”¾é–‹å³å¯ç™¼å°„ï¼</p>

    <script type="text/python">
from browser import document, html, timer, window
from random import random

canvas = document["gameCanvas"]
ctx = canvas.getContext("2d")
WIDTH, HEIGHT = 800, 400

# è¼‰å…¥åœ–ç‰‡ (å°æ‡‰ Flask çš„ static è³‡æ–™å¤¾)
bird_img = html.IMG(src="/static/images/bird.png")
pig_img = html.IMG(src="/static/images/pig.png")

# éŠæˆ²å¸¸æ•¸
SLING_X, SLING_Y = 120, 300
MAX_SHOTS = 10

# éŠæˆ²ç‹€æ…‹è®Šæ•¸
shots_fired = 0
total_score = 0
mouse_down = False
mouse_pos = (SLING_X, SLING_Y)
projectile = None
game_phase = "playing"
game_over_countdown = 0
pigs = []

class Pig:
    def __init__(self):
        self.w, self.h = 40, 40
        self.x, self.y = 0, 0
        self.alive = True
        # æœ¨é€ å»ºç¯‰è£é£¾å¡Š (ç›¸å°åº§æ¨™)
        self.house_blocks = [(0, 40, 120, 15), (0, -10, 15, 50), (105, -10, 15, 50), (0, -25, 120, 15)]

    def draw(self):
        if not self.alive: return
        ctx.fillStyle = "#8B4513" # éè¤è‰²
        for rx, ry, rw, rh in self.house_blocks:
            ctx.fillRect(self.x + rx - 40, self.y + ry, rw, rh)
        if pig_img.complete:
            ctx.drawImage(pig_img, self.x, self.y, self.w, self.h)

    def hit(self, px, py):
        # ç°¡å–®çš„ç¢°æ’ç®±åµæ¸¬
        return self.alive and self.x <= px <= self.x + self.w and self.y <= py <= self.y + self.h

    def relocate(self, other_pigs):
        """ è‡ªå‹•åˆ†æ•£æ¼”ç®—æ³•ï¼šç¢ºä¿ä¸‰éš»è±¬ä¸é‡ç–Š """
        MIN_DIST = 150 # æœ€å°å®‰å…¨é–“éš”
        for _ in range(100): # å˜—è©¦å°‹æ‰¾åˆé©ä½ç½®
            new_x = 450 + random() * (WIDTH - 580)